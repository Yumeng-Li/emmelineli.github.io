<!DOCTYPE html>
<html class="has-navbar-fixed-top">
<head>
    <meta charset="utf-8">
<title>YumengsQuantLab</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css">




<meta name="description" content="">





    <meta name="description" content="Covid: Weighted Linear Regression ModelPreliminaries1cd &#x2F;Users&#x2F;yumengli&#x2F;Documents&#x2F;Python&#x2F;covid_regressions&#x2F;module  &#x2F;Users&#x2F;yumengli&#x2F;Documents&#x2F;Python&#x2F;covid_regressions&#x2F;module 12345678910import numpy as">
<meta property="og:type" content="article">
<meta property="og:title" content="YumengsQuantLab">
<meta property="og:url" content="http://yoursite.com/2021/09/20/Covid_WeightedLinearRegression/index.html">
<meta property="og:site_name" content="YumengsQuantLab">
<meta property="og:description" content="Covid: Weighted Linear Regression ModelPreliminaries1cd &#x2F;Users&#x2F;yumengli&#x2F;Documents&#x2F;Python&#x2F;covid_regressions&#x2F;module  &#x2F;Users&#x2F;yumengli&#x2F;Documents&#x2F;Python&#x2F;covid_regressions&#x2F;module 12345678910import numpy as">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://yoursite.com/2021/09/20/Covid_WeightedLinearRegression/Covid_WeightedLinearRegression_files/Covid_WeightedLinearRegression_54_0.png">
<meta property="og:image" content="http://yoursite.com/2021/09/20/Covid_WeightedLinearRegression/Covid_WeightedLinearRegression_files/Covid_WeightedLinearRegression_73_1.png">
<meta property="og:image" content="http://yoursite.com/2021/09/20/Covid_WeightedLinearRegression/Covid_WeightedLinearRegression_files/Covid_WeightedLinearRegression_76_0.png">
<meta property="og:image" content="http://yoursite.com/2021/09/20/Covid_WeightedLinearRegression/Covid_WeightedLinearRegression_files/Covid_WeightedLinearRegression_77_0.png">
<meta property="og:image" content="http://yoursite.com/2021/09/20/Covid_WeightedLinearRegression/Covid_WeightedLinearRegression_files/Covid_WeightedLinearRegression_94_0.png">
<meta property="og:image" content="http://yoursite.com/2021/09/20/Covid_WeightedLinearRegression/Covid_WeightedLinearRegression_files/Covid_WeightedLinearRegression_97_1.png">
<meta property="article:published_time" content="2021-09-21T04:14:22.319Z">
<meta property="article:modified_time" content="2021-09-21T04:14:22.319Z">
<meta property="article:author" content="Yumeng Li">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/2021/09/20/Covid_WeightedLinearRegression/Covid_WeightedLinearRegression_files/Covid_WeightedLinearRegression_54_0.png">





<link rel="icon" href="/favicon.png">


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/css/justifiedGallery.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">


<link rel="stylesheet" href="/css/style.css">


<script defer src="//use.fontawesome.com/releases/v5.0.8/js/all.js"></script>


    
    
    
    
    
    
    
    
    
    

    


<meta name="generator" content="Hexo 5.0.0"></head>
<body>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/">
                
                    
                    YUMENG&#39;S QUANT LAB
                    
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item "
               href="/archives">Archives</a>
            
            <a class="navbar-item "
               href="/categories">Category</a>
            
            <a class="navbar-item "
               target="_blank" rel="noopener" href="http://yumengsblog.com/">Blog</a>
            
            <a class="navbar-item "
               target="_blank" rel="noopener" href="https://www.linkedin.com/in/yumenglovestheworld/">Linkedin</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            <a class="navbar-item search" title="Search" href="javascript:;">
                <i class="fas fa-search"></i>
            </a>
            
            
            
            <a class="navbar-item" title="GitHub" target="_blank" rel="noopener" href="https://github.com/ppoffice/hexo-theme-minos">
                
                <i class="fab fa-github"></i>
                
            </a>
               
            
        </div>
    </div>
</nav>

    <section class="section">
    <div class="container">
    <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2021-09-21T04:14:22.319Z" itemprop="datePublished">Sep 20 2021</time>
        </span>
        
        
        <span class="column is-narrow">
            
            
            18 minutes read (About 2761 words)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <html><head></head><body><h1 id="Covid-Weighted-Linear-Regression-Model"><a href="#Covid-Weighted-Linear-Regression-Model" class="headerlink" title="Covid: Weighted Linear Regression Model"></a>Covid: Weighted Linear Regression Model</h1><h2 id="Preliminaries"><a href="#Preliminaries" class="headerlink" title="Preliminaries"></a>Preliminaries</h2><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /Users/yumengli/Documents/Python/covid_regressions/module</span><br></pre></td></tr></tbody></table></figure>

<pre><code>/Users/yumengli/Documents/Python/covid_regressions/module</code></pre>
<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np</span><br><span class="line"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd</span><br><span class="line"><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt</span><br><span class="line"><span class="hljs-keyword">import</span> matplotlib.colors</span><br><span class="line"><span class="hljs-keyword">import</span> seaborn <span class="hljs-keyword">as</span> sns</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">import</span> statsmodels.api <span class="hljs-keyword">as</span> sm</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">import</span> sys</span><br><span class="line"><span class="hljs-keyword">import</span> covid_analysis <span class="hljs-keyword">as</span> covid</span><br></pre></td></tr></tbody></table></figure>

<h2 id="Select-Event"><a href="#Select-Event" class="headerlink" title="Select Event"></a>Select Event</h2><p>Select one of</p>
<ul>
<li>cases</li>
<li>deaths</li>
<li>admissions</li>
</ul>
<p>This will set up the analysis for that particular variable</p>
<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">event=<span class="hljs-string">&quot;admissions&quot;</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="Data"><a href="#Data" class="headerlink" title="Data"></a>Data</h2><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data_dir=<span class="hljs-string">&quot;../data&quot;</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="Cases-and-Deaths"><a href="#Cases-and-Deaths" class="headerlink" title="Cases and Deaths"></a>Cases and Deaths</h3><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cases=pd.read_csv(<span class="hljs-string">f&quot;<span class="hljs-subst">{data_dir}</span>/covid_cases.csv&quot;</span>,parse_dates=[<span class="hljs-string">&quot;date&quot;</span>])</span><br><span class="line">cases.head()</span><br></pre></td></tr></tbody></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;</code></pre>
<p></style><p></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>state</th>
      <th>cases</th>
      <th>deaths</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2020-02-08</td>
      <td>AL</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2021-02-02</td>
      <td>IL</td>
      <td>2304</td>
      <td>63</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2020-07-30</td>
      <td>ME</td>
      <td>22</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2020-03-29</td>
      <td>AL</td>
      <td>129</td>
      <td>5</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2020-05-03</td>
      <td>NH</td>
      <td>89</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>



<h3 id="Hospital-Admissions"><a href="#Hospital-Admissions" class="headerlink" title="Hospital Admissions"></a>Hospital Admissions</h3><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hospitalizations=pd.read_csv(<span class="hljs-string">f&quot;<span class="hljs-subst">{data_dir}</span>/covid_hospitalizations.csv&quot;</span>,parse_dates=[<span class="hljs-string">&quot;date&quot;</span>])</span><br><span class="line">hospitalizations.head()</span><br></pre></td></tr></tbody></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;</code></pre>
<p></style><p></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>state</th>
      <th>used_beds</th>
      <th>admissions</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2020-07-27</td>
      <td>PR</td>
      <td>514.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2020-07-24</td>
      <td>PR</td>
      <td>453.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2020-07-23</td>
      <td>PR</td>
      <td>448.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2020-07-22</td>
      <td>IA</td>
      <td>0.0</td>
      <td>33.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2020-07-22</td>
      <td>PR</td>
      <td>419.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>



<h3 id="Vaccinations"><a href="#Vaccinations" class="headerlink" title="Vaccinations"></a>Vaccinations</h3><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vaccinations=pd.read_csv(<span class="hljs-string">f&quot;<span class="hljs-subst">{data_dir}</span>/covid_vaccinations.csv&quot;</span>,parse_dates=[<span class="hljs-string">&quot;date&quot;</span>])</span><br><span class="line">vaccinations.head()</span><br></pre></td></tr></tbody></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;</code></pre>
<p></style><p></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>state</th>
      <th>vaccinated</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2021-08-24</td>
      <td>HI</td>
      <td>774774</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2021-08-24</td>
      <td>KY</td>
      <td>2128895</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2021-08-24</td>
      <td>VA</td>
      <td>4820547</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2021-08-24</td>
      <td>NV</td>
      <td>1444294</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2021-08-24</td>
      <td>KS</td>
      <td>1381260</td>
    </tr>
  </tbody>
</table>
</div>



<h3 id="Population"><a href="#Population" class="headerlink" title="Population"></a>Population</h3><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">population=pd.read_csv(<span class="hljs-string">f&quot;<span class="hljs-subst">{data_dir}</span>/population.csv&quot;</span>)</span><br><span class="line">population.head()                       </span><br></pre></td></tr></tbody></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;</code></pre>
<p></style><p></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>state</th>
      <th>population</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AL</td>
      <td>4921532</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AK</td>
      <td>731158</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AZ</td>
      <td>7421401</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AR</td>
      <td>3030522</td>
    </tr>
    <tr>
      <th>4</th>
      <td>CA</td>
      <td>39368078</td>
    </tr>
  </tbody>
</table>
</div>



<h3 id="Used-Dataset"><a href="#Used-Dataset" class="headerlink" title="Used Dataset"></a>Used Dataset</h3><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">if</span> event==<span class="hljs-string">&quot;admissions&quot;</span>:</span><br><span class="line">    data=hospitalizations</span><br><span class="line"><span class="hljs-keyword">else</span>:</span><br><span class="line">    data=cases</span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data=data.merge(vaccinations,on=[<span class="hljs-string">&quot;date&quot;</span>,<span class="hljs-string">&quot;state&quot;</span>])</span><br><span class="line">data.head()</span><br></pre></td></tr></tbody></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;</code></pre>
<p></style><p></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>state</th>
      <th>used_beds</th>
      <th>admissions</th>
      <th>vaccinated</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2021-06-14</td>
      <td>VI</td>
      <td>9.0</td>
      <td>0.0</td>
      <td>33112</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2021-06-10</td>
      <td>MT</td>
      <td>66.0</td>
      <td>16.0</td>
      <td>429634</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2021-05-12</td>
      <td>HI</td>
      <td>62.0</td>
      <td>4.0</td>
      <td>583992</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2021-05-17</td>
      <td>CO</td>
      <td>589.0</td>
      <td>74.0</td>
      <td>2380766</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2021-07-15</td>
      <td>CA</td>
      <td>2099.0</td>
      <td>302.0</td>
      <td>20309600</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data=data.merge(population,on=<span class="hljs-string">&quot;state&quot;</span>)</span><br><span class="line">data.head()</span><br></pre></td></tr></tbody></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;</code></pre>
<p></style><p></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>state</th>
      <th>used_beds</th>
      <th>admissions</th>
      <th>vaccinated</th>
      <th>population</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2021-06-10</td>
      <td>MT</td>
      <td>66.0</td>
      <td>16.0</td>
      <td>429634</td>
      <td>1080577</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2021-06-21</td>
      <td>MT</td>
      <td>57.0</td>
      <td>13.0</td>
      <td>444781</td>
      <td>1080577</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2021-08-05</td>
      <td>MT</td>
      <td>149.0</td>
      <td>23.0</td>
      <td>475619</td>
      <td>1080577</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2021-07-15</td>
      <td>MT</td>
      <td>62.0</td>
      <td>9.0</td>
      <td>466509</td>
      <td>1080577</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2021-08-21</td>
      <td>MT</td>
      <td>224.0</td>
      <td>59.0</td>
      <td>485391</td>
      <td>1080577</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data[<span class="hljs-string">&quot;vaccinated&quot;</span>]=data[<span class="hljs-string">&quot;vaccinated&quot;</span>]/data[<span class="hljs-string">&quot;population&quot;</span>]</span><br><span class="line">data.head()</span><br></pre></td></tr></tbody></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;</code></pre>
<p></style><p></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>state</th>
      <th>used_beds</th>
      <th>admissions</th>
      <th>vaccinated</th>
      <th>population</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2021-06-10</td>
      <td>MT</td>
      <td>66.0</td>
      <td>16.0</td>
      <td>0.397597</td>
      <td>1080577</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2021-06-21</td>
      <td>MT</td>
      <td>57.0</td>
      <td>13.0</td>
      <td>0.411614</td>
      <td>1080577</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2021-08-05</td>
      <td>MT</td>
      <td>149.0</td>
      <td>23.0</td>
      <td>0.440153</td>
      <td>1080577</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2021-07-15</td>
      <td>MT</td>
      <td>62.0</td>
      <td>9.0</td>
      <td>0.431722</td>
      <td>1080577</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2021-08-21</td>
      <td>MT</td>
      <td>224.0</td>
      <td>59.0</td>
      <td>0.449196</td>
      <td>1080577</td>
    </tr>
  </tbody>
</table>
</div>



<h2 id="Single-Period-Regression"><a href="#Single-Period-Regression" class="headerlink" title="Single Period Regression"></a>Single Period Regression</h2><h3 id="Model-Definition"><a href="#Model-Definition" class="headerlink" title="Model Definition"></a>Model Definition</h3><p>The weighted linear regression model is defined as:<br>\begin{eqnarray}<br>    \hat{y}_i &amp;= c + \beta x_i \<br>    y_i &amp;=\hat{y}_i+ \epsilon_i \<br>\end{eqnarray}<br>and we minimize the <strong>weighted least squares error</strong> :<br>\begin{equation}<br>    E_w = \sum_i P_i(y - \hat{y}_i)^2<br>\end{equation}<br>where </p>
<ul>
<li>Each observation $i$ represents a single state.</li>
<li>$\hat{y}_i$ is the predicted probability of an event (cases, deaths or hospital admissions) <em>per  persons</em> on that state.</li>
<li>$y_i$ is the actual number of events per person observed.</li>
<li>$x_i$ is the percentage of the state population fully vaccinated.</li>
<li>$P_i$ is the population of the  state.</li>
<li>$\epsilon_i$ is a Gaussian uncorrelated noise with constant variance $\sigma$ </li>
<li>the parameters $c$ and $\beta$ will be fitted to the observed data to maximize agreement with the model</li>
</ul>
<p>We first fit the regression model to <strong>single  day</strong> of state hospitalization data.</p>
<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">offset=<span class="hljs-number">9</span> <span class="hljs-comment"># if we do not want to look at the last day, substract here.</span></span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">last_date=data[<span class="hljs-string">&quot;date&quot;</span>].max()-pd.offsets.Day(offset)</span><br><span class="line">last_date</span><br></pre></td></tr></tbody></table></figure>




<pre><code>Timestamp(&apos;2021-08-15 00:00:00&apos;)</code></pre>
<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">last_data=data[data[<span class="hljs-string">&quot;date&quot;</span>]==last_date]</span><br><span class="line">last_data.head()</span><br></pre></td></tr></tbody></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;</code></pre>
<p></style><p></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>state</th>
      <th>used_beds</th>
      <th>admissions</th>
      <th>vaccinated</th>
      <th>population</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>75</th>
      <td>2021-08-15</td>
      <td>MT</td>
      <td>194.0</td>
      <td>35.0</td>
      <td>0.444864</td>
      <td>1080577</td>
    </tr>
    <tr>
      <th>241</th>
      <td>2021-08-15</td>
      <td>HI</td>
      <td>318.0</td>
      <td>42.0</td>
      <td>0.546276</td>
      <td>1407006</td>
    </tr>
    <tr>
      <th>348</th>
      <td>2021-08-15</td>
      <td>CO</td>
      <td>646.0</td>
      <td>112.0</td>
      <td>0.550732</td>
      <td>5807719</td>
    </tr>
    <tr>
      <th>658</th>
      <td>2021-08-15</td>
      <td>CA</td>
      <td>7636.0</td>
      <td>859.0</td>
      <td>0.544115</td>
      <td>39368078</td>
    </tr>
    <tr>
      <th>813</th>
      <td>2021-08-15</td>
      <td>MA</td>
      <td>416.0</td>
      <td>59.0</td>
      <td>0.647362</td>
      <td>6893574</td>
    </tr>
  </tbody>
</table>
</div>



<h3 id="Regression-Data"><a href="#Regression-Data" class="headerlink" title="Regression Data"></a>Regression Data</h3><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X=sm.add_constant(last_data[<span class="hljs-string">&quot;vaccinated&quot;</span>])</span><br><span class="line">X.head()</span><br></pre></td></tr></tbody></table></figure>

<pre><code>/opt/anaconda3/lib/python3.7/site-packages/statsmodels/tsa/tsatools.py:142: FutureWarning: In a future version of pandas all arguments of concat except for the argument &apos;objs&apos; will be keyword-only
  x = pd.concat(x[::order], 1)</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;</code></pre>
<p></style><p></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>const</th>
      <th>vaccinated</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>75</th>
      <td>1.0</td>
      <td>0.444864</td>
    </tr>
    <tr>
      <th>241</th>
      <td>1.0</td>
      <td>0.546276</td>
    </tr>
    <tr>
      <th>348</th>
      <td>1.0</td>
      <td>0.550732</td>
    </tr>
    <tr>
      <th>658</th>
      <td>1.0</td>
      <td>0.544115</td>
    </tr>
    <tr>
      <th>813</th>
      <td>1.0</td>
      <td>0.647362</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">P=last_data[<span class="hljs-string">&quot;population&quot;</span>]</span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">P.head()</span><br></pre></td></tr></tbody></table></figure>




<pre><code>75      1080577
241     1407006
348     5807719
658    39368078
813     6893574
Name: population, dtype: int64</code></pre>
<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Y=last_data[event]/last_data[<span class="hljs-string">&quot;population&quot;</span>]</span><br><span class="line">Y.head()</span><br></pre></td></tr></tbody></table></figure>




<pre><code>75     0.000032
241    0.000030
348    0.000019
658    0.000022
813    0.000009
dtype: float64</code></pre>
<h3 id="statmodels-Weighted-Linear-Regression"><a href="#statmodels-Weighted-Linear-Regression" class="headerlink" title="statmodels  Weighted Linear Regression"></a>statmodels  Weighted Linear Regression</h3><p>We first use the  <strong>Weighted Linear Regression</strong> model from <a target="_blank" rel="noopener" href="https://www.statsmodels.org/stable/generated/statsmodels.discrete.discrete_model.Poisson.html">statmodels</a>.</p>
<p>The model is called <code>WLS</code> for <em>Weighted Least Squares</em>.</p>
<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mod=sm.WLS(Y,X,P)</span><br><span class="line">res=mod.fit()</span><br><span class="line">res.summary()</span><br></pre></td></tr></tbody></table></figure>




<table class="simpletable">
<caption>WLS Regression Results</caption>
<tbody><tr>
  <th>Dep. Variable:</th>            <td>y</td>        <th>  R-squared:         </th> <td>   0.327</td>
</tr>
<tr>
  <th>Model:</th>                   <td>WLS</td>       <th>  Adj. R-squared:    </th> <td>   0.313</td>
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th> <td>   23.77</td>
</tr>
<tr>
  <th>Date:</th>             <td>Mon, 20 Sep 2021</td> <th>  Prob (F-statistic):</th> <td>1.18e-05</td>
</tr>
<tr>
  <th>Time:</th>                 <td>22:34:40</td>     <th>  Log-Likelihood:    </th> <td>  468.45</td>
</tr>
<tr>
  <th>No. Observations:</th>      <td>    51</td>      <th>  AIC:               </th> <td>  -932.9</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td>    49</td>      <th>  BIC:               </th> <td>  -929.0</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     1</td>      <th>                     </th>     <td> </td>   
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>     <td> </td>   
</tr>
</tbody></table>
<table class="simpletable">
<tbody><tr>
       <td></td>         <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P&gt;|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>const</th>      <td>    0.0001</td> <td> 1.97e-05</td> <td>    6.446</td> <td> 0.000</td> <td> 8.73e-05</td> <td>    0.000</td>
</tr>
<tr>
  <th>vaccinated</th> <td>   -0.0002</td> <td> 3.89e-05</td> <td>   -4.875</td> <td> 0.000</td> <td>   -0.000</td> <td>   -0.000</td>
</tr>
</tbody></table>
<table class="simpletable">
<tbody><tr>
  <th>Omnibus:</th>       <td>73.676</td> <th>  Durbin-Watson:     </th> <td>   2.094</td> 
</tr>
<tr>
  <th>Prob(Omnibus):</th> <td> 0.000</td> <th>  Jarque-Bera (JB):  </th> <td> 909.829</td> 
</tr>
<tr>
  <th>Skew:</th>          <td> 3.770</td> <th>  Prob(JB):          </th> <td>2.71e-198</td>
</tr>
<tr>
  <th>Kurtosis:</th>      <td>22.269</td> <th>  Cond. No.          </th> <td>    17.7</td> 
</tr>
</tbody></table><br><br>Notes:<br>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.




<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.params</span><br></pre></td></tr></tbody></table></figure>




<pre><code>const         0.000127
vaccinated   -0.000190
dtype: float64</code></pre>
<p>The average vaccination rate is</p>
<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vac_mean=np.sum(P*last_data[<span class="hljs-string">&quot;vaccinated&quot;</span>])/np.sum(P)</span><br><span class="line">vac_mean</span><br></pre></td></tr></tbody></table></figure>




<pre><code>0.5005361699932351</code></pre>
<p>The expected number of  events per 100k person&#x2019;s assuming an state with the average vaccination rate is:</p>
<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">even_mean=(res.params[<span class="hljs-string">&quot;const&quot;</span>]+res.params[<span class="hljs-string">&quot;vaccinated&quot;</span>]*vac_mean)</span><br><span class="line">even_mean*<span class="hljs-number">100</span>_000</span><br></pre></td></tr></tbody></table></figure>




<pre><code>3.186192980837503</code></pre>
<p>A 10% change in the vaccination rate will affect events by a percentage of</p>
<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vac_effect=res.params[<span class="hljs-string">&quot;vaccinated&quot;</span>]*<span class="hljs-number">0.1</span>/even_mean</span><br><span class="line">print(<span class="hljs-string">f&quot;<span class="hljs-subst">{vac_effect:<span class="hljs-number">.0</span>%}</span>&quot;</span>)</span><br></pre></td></tr></tbody></table></figure>

<pre><code>-60%</code></pre>
<p>The R-square is defined as ratio of square loss to target variance<br>$$<br> R^2 = 1 - \frac{\sum_{i=1}^N P_i(y_i-\hat{y}<em>i)^2}{\sum</em>{i=1}^N P_i(y_i-\bar{y})^2}<br>$$</p>
<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">square_error</span>(<span class="hljs-params">y,y_hat,P</span>):</span></span><br><span class="line">    err=y-y_hat</span><br><span class="line">    <span class="hljs-keyword">return</span> np.sum(P*err**<span class="hljs-number">2</span>)</span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Y_pred=res.predict(X)</span><br><span class="line">Y_bar=(Y*P).sum()/P.sum()</span><br><span class="line">R2=<span class="hljs-number">1</span> - square_error(Y,Y_pred,P)/square_error(Y,Y_bar,P)</span><br><span class="line">R2</span><br></pre></td></tr></tbody></table></figure>




<pre><code>0.3266337795171833</code></pre>
<h3 id="statmodels-Generalized-Linear-Model"><a href="#statmodels-Generalized-Linear-Model" class="headerlink" title="statmodels Generalized Linear Model"></a>statmodels Generalized Linear Model</h3><p>Exactly the same model can be written in the more general language of <strong>Generalized Linear models</strong> as</p>
<h3 id="Model-Definition-1"><a href="#Model-Definition-1" class="headerlink" title="Model Definition"></a>Model Definition</h3><p>The linear regression  model is defined as:<br>\begin{eqnarray}<br>    &amp;\eta_i &amp;=c + \beta*x_i \<br>    \mathbb{E}(y_i|x_i) =&amp; \hat{y}_i &amp;= \eta_i  \<br>    &amp;p(y_i|x_i) &amp; = N(\hat{y}_i,\sigma)<br>\end{eqnarray}</p>
<p>The fact that $\eta_i=\hat{y}_i$ means we are using the <strong>identity</strong> link between the Gaussian family and the linear model $\eta$.</p>
<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">glm_model=sm.GLM(Y,X,family=sm.families.Gaussian(sm.families.links.identity()),var_weights=P)</span><br><span class="line">glm_res=glm_model.fit()</span><br><span class="line">glm_res.summary()</span><br></pre></td></tr></tbody></table></figure>




<table class="simpletable">
<caption>Generalized Linear Model Regression Results</caption>
<tbody><tr>
  <th>Dep. Variable:</th>           <td>y</td>        <th>  No. Observations:  </th>  <td>    51</td>  
</tr>
<tr>
  <th>Model:</th>                  <td>GLM</td>       <th>  Df Residuals:      </th>  <td>    49</td>  
</tr>
<tr>
  <th>Model Family:</th>        <td>Gaussian</td>     <th>  Df Model:          </th>  <td>     1</td>  
</tr>
<tr>
  <th>Link Function:</th>       <td>identity</td>     <th>  Scale:             </th> <td>0.0024992</td>
</tr>
<tr>
  <th>Method:</th>                <td>IRLS</td>       <th>  Log-Likelihood:    </th> <td>  468.45</td> 
</tr>
<tr>
  <th>Date:</th>            <td>Mon, 20 Sep 2021</td> <th>  Deviance:          </th> <td> 0.12246</td> 
</tr>
<tr>
  <th>Time:</th>                <td>22:34:41</td>     <th>  Pearson chi2:      </th>  <td> 0.122</td>  
</tr>
<tr>
  <th>No. Iterations:</th>          <td>3</td>        <th>                     </th>     <td> </td>    
</tr>
<tr>
  <th>Covariance Type:</th>     <td>nonrobust</td>    <th>                     </th>     <td> </td>    
</tr>
</tbody></table>
<table class="simpletable">
<tbody><tr>
       <td></td>         <th>coef</th>     <th>std err</th>      <th>z</th>      <th>P&gt;|z|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>const</th>      <td>    0.0001</td> <td> 1.97e-05</td> <td>    6.446</td> <td> 0.000</td> <td> 8.83e-05</td> <td>    0.000</td>
</tr>
<tr>
  <th>vaccinated</th> <td>   -0.0002</td> <td> 3.89e-05</td> <td>   -4.875</td> <td> 0.000</td> <td>   -0.000</td> <td>   -0.000</td>
</tr>
</tbody></table>



<p>Results <strong>are the same</strong> but with the <code>GLM</code> language we will be able to perform regression many more kind  of variables.</p>
<p>The generalization of square error for a GLM model is called the  <strong>deviance</strong>. This is  the <em>square error</em> the Gaussian Family used  in linear regression.</p>
<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">glm_res.params</span><br></pre></td></tr></tbody></table></figure>




<pre><code>const         0.000127
vaccinated   -0.000190
dtype: float64</code></pre>
<h3 id="In-Sample-R-2"><a href="#In-Sample-R-2" class="headerlink" title="In Sample $R^2$"></a>In Sample $R^2$</h3><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">glm_res.deviance, square_error(Y,Y_pred,P)</span><br></pre></td></tr></tbody></table></figure>




<pre><code>(0.12246143037040369, 0.12246143037040369)</code></pre>
<p>The resuls also include the deviance for the <strong>null model</strong> fitted to just a constant</p>
<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">glm_res.null_deviance,square_error(Y,Y_bar,P)</span><br></pre></td></tr></tbody></table></figure>




<pre><code>(0.1818645287591, 0.1818645287591)</code></pre>
<p>The ratio defines an $R^2$ value.</p>
<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-number">1</span>-glm_res.deviance/glm_res.null_deviance</span><br></pre></td></tr></tbody></table></figure>




<pre><code>0.3266337795171833</code></pre>
<h4 id="Model-Residuals"><a href="#Model-Residuals" class="headerlink" title="Model Residuals"></a>Model Residuals</h4><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">covid.plot_residuals(last_data,event,glm_res)</span><br></pre></td></tr></tbody></table></figure>


<p><img src="Covid_WeightedLinearRegression_files/Covid_WeightedLinearRegression_54_0.png" alt="png"></p>
<p>We can see that </p>
<ul>
<li>Predicted events can be negative for large vaccination rates. </li>
<li>residual variance  is negatively correlated with  vaccinations rate (smaller vaccination rates have larger magnitude residuals).<br>A <strong>Poisson model</strong> can fix those issues.</li>
</ul>
<h2 id="Multiple-Period-Regression"><a href="#Multiple-Period-Regression" class="headerlink" title="Multiple Period Regression"></a>Multiple Period Regression</h2><h3 id="Model-Definition-2"><a href="#Model-Definition-2" class="headerlink" title="Model Definition"></a>Model Definition</h3><p>We have data from multiple dates, so it makes sense to incorporate Time as a extra variable.</p>
<p>\begin{eqnarray}<br>    &amp;\eta_i &amp;=c + \beta_1 x_i  + \beta_2 t_i + \beta_3 t_i^2 \<br>    \mathbb{E}(y_i|x_i) =&amp; \hat{y}_i &amp;= \eta_i  \<br>    &amp;p(y_i|x_i) &amp; = N(\hat{y_i},\sigma^2)<br>\end{eqnarray}<br>where<br>where </p>
<ul>
<li>Each observation $i$ represents a single state at one particular date.</li>
<li>$y_i$ is the number of events on that state.</li>
<li>$\hat{y}_i$ is the <em>predicted</em> number of events on that state.</li>
<li>$x_i$ is the percentage of the state population fully vaccinated on that state.</li>
<li>$t_i$ is the number of days elapsed since the beginning of the training period.</li>
<li>$\sigma^2$ is the level of <em>noise</em> of the observations (the variance of the residuals).</li>
<li>the parameters $c$ and $\beta_1,\beta_2,\beta_3$ will be fitted to the observed data to maximize agreement with the model</li>
</ul>
<p>We including coefficients for $t$ and $t^2$ the dependence of the admission rate on time can have some curvature and does not need to be linear.</p>
<p>This can be fitter as a <strong>linear model</strong> where the inputs are $x_i$, $t_i$ and $t_i^2$</p>
<h3 id="Regression-Data-1"><a href="#Regression-Data-1" class="headerlink" title="Regression Data"></a>Regression Data</h3><p>Firs we select the training period:</p>
<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">start_train=<span class="hljs-string">&quot;2021-07-15&quot;</span></span><br><span class="line">end_train=<span class="hljs-string">&quot;2021-08-15&quot;</span></span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">#greater than the start date and smaller than the end date</span></span><br><span class="line">mask = (data[<span class="hljs-string">&apos;date&apos;</span>] &gt;= start_train) &amp; (data[<span class="hljs-string">&apos;date&apos;</span>] &lt;= end_train)</span><br><span class="line">train_data=data[mask].copy()</span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">date0=train_data[<span class="hljs-string">&quot;date&quot;</span>].min()</span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train_data.head()</span><br></pre></td></tr></tbody></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;</code></pre>
<p></style><p></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>state</th>
      <th>used_beds</th>
      <th>admissions</th>
      <th>vaccinated</th>
      <th>population</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>2021-08-05</td>
      <td>MT</td>
      <td>149.0</td>
      <td>23.0</td>
      <td>0.440153</td>
      <td>1080577</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2021-07-15</td>
      <td>MT</td>
      <td>62.0</td>
      <td>9.0</td>
      <td>0.431722</td>
      <td>1080577</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2021-07-25</td>
      <td>MT</td>
      <td>84.0</td>
      <td>10.0</td>
      <td>0.435852</td>
      <td>1080577</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2021-08-08</td>
      <td>MT</td>
      <td>152.0</td>
      <td>27.0</td>
      <td>0.441906</td>
      <td>1080577</td>
    </tr>
    <tr>
      <th>10</th>
      <td>2021-07-30</td>
      <td>MT</td>
      <td>116.0</td>
      <td>30.0</td>
      <td>0.437877</td>
      <td>1080577</td>
    </tr>
  </tbody>
</table>
</div>



<p>We write a function to generate our <strong>design matrix</strong>:</p>
<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X_train,P_train=covid.define_variables(train_data,date0)</span><br><span class="line">X_train.head()</span><br></pre></td></tr></tbody></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;</code></pre>
<p></style><p></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>vaccinated</th>
      <th>T</th>
      <th>T2</th>
      <th>const</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>0.440153</td>
      <td>21</td>
      <td>441</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.431722</td>
      <td>0</td>
      <td>0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.435852</td>
      <td>10</td>
      <td>100</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.441906</td>
      <td>24</td>
      <td>576</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.437877</td>
      <td>15</td>
      <td>225</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Y_train=train_data[event]/train_data[<span class="hljs-string">&quot;population&quot;</span>]</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Weighted-Linear-Regression"><a href="#Weighted-Linear-Regression" class="headerlink" title="Weighted Linear Regression"></a>Weighted Linear Regression</h3><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mod=sm.WLS(Y_train,X_train,P_train)</span><br><span class="line">res=mod.fit()</span><br><span class="line">res.summary()</span><br></pre></td></tr></tbody></table></figure>




<table class="simpletable">
<caption>WLS Regression Results</caption>
<tbody><tr>
  <th>Dep. Variable:</th>            <td>y</td>        <th>  R-squared:         </th>  <td>   0.373</td> 
</tr>
<tr>
  <th>Model:</th>                   <td>WLS</td>       <th>  Adj. R-squared:    </th>  <td>   0.371</td> 
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th>  <td>   322.3</td> 
</tr>
<tr>
  <th>Date:</th>             <td>Mon, 20 Sep 2021</td> <th>  Prob (F-statistic):</th>  <td>3.12e-164</td>
</tr>
<tr>
  <th>Time:</th>                 <td>22:34:43</td>     <th>  Log-Likelihood:    </th>  <td>  15151.</td> 
</tr>
<tr>
  <th>No. Observations:</th>      <td>  1632</td>      <th>  AIC:               </th> <td>-3.029e+04</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td>  1628</td>      <th>  BIC:               </th> <td>-3.027e+04</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     3</td>      <th>                     </th>      <td> </td>    
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>      <td> </td>    
</tr>
</tbody></table>
<table class="simpletable">
<tbody><tr>
       <td></td>         <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P&gt;|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>vaccinated</th> <td>   -0.0002</td> <td> 6.13e-06</td> <td>  -24.647</td> <td> 0.000</td> <td>   -0.000</td> <td>   -0.000</td>
</tr>
<tr>
  <th>T</th>          <td> 1.038e-06</td> <td> 1.82e-07</td> <td>    5.686</td> <td> 0.000</td> <td>  6.8e-07</td> <td>  1.4e-06</td>
</tr>
<tr>
  <th>T2</th>         <td> -1.18e-09</td> <td> 5.69e-09</td> <td>   -0.207</td> <td> 0.836</td> <td>-1.23e-08</td> <td> 9.98e-09</td>
</tr>
<tr>
  <th>const</th>      <td>   8.1e-05</td> <td> 3.17e-06</td> <td>   25.544</td> <td> 0.000</td> <td> 7.48e-05</td> <td> 8.72e-05</td>
</tr>
</tbody></table>
<table class="simpletable">
<tbody><tr>
  <th>Omnibus:</th>       <td>1418.486</td> <th>  Durbin-Watson:     </th> <td>   0.372</td> 
</tr>
<tr>
  <th>Prob(Omnibus):</th>  <td> 0.000</td>  <th>  Jarque-Bera (JB):  </th> <td>43359.192</td>
</tr>
<tr>
  <th>Skew:</th>           <td> 4.022</td>  <th>  Prob(JB):          </th> <td>    0.00</td> 
</tr>
<tr>
  <th>Kurtosis:</th>       <td>26.936</td>  <th>  Cond. No.          </th> <td>6.93e+03</td> 
</tr>
</tbody></table><br><br>Notes:<br>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.<br>[2] The condition number is large, 6.93e+03. This might indicate that there are<br>strong multicollinearity or other numerical problems.




<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.params</span><br></pre></td></tr></tbody></table></figure>




<pre><code>vaccinated   -1.511215e-04
T             1.037547e-06
T2           -1.179850e-09
const         8.099511e-05
dtype: float64</code></pre>
<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># weighted average</span></span><br><span class="line">Y_bar=np.sum(Y_train*P_train)/np.sum(P_train)</span><br><span class="line">Y_bar</span><br></pre></td></tr></tbody></table></figure>




<pre><code>2.2866902299871973e-05</code></pre>
<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Y_pred=res.predict(X_train)</span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">deviance=square_error(Y_train,Y_pred,P_train)</span><br><span class="line">null_deviance=square_error(Y_train,Y_bar,P_train)</span><br><span class="line">deviance,null_deviance</span><br></pre></td></tr></tbody></table></figure>




<pre><code>(3.2184382974951373, 5.12981850956498)</code></pre>
<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">R2=<span class="hljs-number">1</span>-deviance/null_deviance</span><br><span class="line">R2</span><br></pre></td></tr></tbody></table></figure>




<pre><code>0.3726019173009557</code></pre>
<h3 id="Extrapolation-of-Time-trends"><a href="#Extrapolation-of-Time-trends" class="headerlink" title="Extrapolation of Time trends"></a>Extrapolation of Time trends</h3><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">covid.plot_time_extrapolation(train_data,res,event,date0)</span><br></pre></td></tr></tbody></table></figure>

<pre><code>/opt/anaconda3/lib/python3.7/site-packages/matplotlib/cbook/__init__.py:1402: FutureWarning: Support for multi-dimensional indexing (e.g. `obj[:, None]`) is deprecated and will be removed in a future version.  Convert to a numpy array before indexing instead.
  x[:, None]
/opt/anaconda3/lib/python3.7/site-packages/matplotlib/axes/_base.py:278: FutureWarning: Support for multi-dimensional indexing (e.g. `obj[:, None]`) is deprecated and will be removed in a future version.  Convert to a numpy array before indexing instead.
  y = y[:, np.newaxis]</code></pre>
<p><img src="Covid_WeightedLinearRegression_files/Covid_WeightedLinearRegression_73_1.png" alt="png"></p>
<h3 id="In-sample-model-Fit"><a href="#In-sample-model-Fit" class="headerlink" title="In-sample model Fit"></a>In-sample model Fit</h3><p>Observations are arranged by state and date.</p>
<p>To visualize the quality of the fit on the training data, we present <strong>snapshots</strong> of the fit for a few selected dates on the training period. </p>
<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">plot_residuals</span>(<span class="hljs-params">data,event,res</span>):</span></span><br><span class="line">    P=data[<span class="hljs-string">&quot;population&quot;</span>]</span><br><span class="line">    <span class="hljs-comment"># Create two subplots and unpack the output array immediately</span></span><br><span class="line">    f, (ax1, ax2) = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>,sharex=<span class="hljs-literal">True</span>,figsize=(<span class="hljs-number">16</span>,<span class="hljs-number">4</span>))</span><br><span class="line">    norm=matplotlib.colors.LogNorm(vmin=<span class="hljs-number">100</span>_000, vmax=P.max(), clip=<span class="hljs-literal">False</span>)</span><br><span class="line">    m=ax1.scatter(data[<span class="hljs-string">&quot;vaccinated&quot;</span>],data[event]/data[<span class="hljs-string">&quot;population&quot;</span>]*<span class="hljs-number">100</span>_000,</span><br><span class="line">                c=P,norm=norm,cmap=<span class="hljs-string">&quot;Blues&quot;</span>,label=event)</span><br><span class="line">    plt.colorbar(m,label=<span class="hljs-string">&quot;State Population&quot;</span>)</span><br><span class="line">    x=np.linspace(<span class="hljs-number">0.3</span>,<span class="hljs-number">0.75</span>,<span class="hljs-number">201</span>)</span><br><span class="line">    x= pd.DataFrame({<span class="hljs-string">&apos;vaccinated&apos;</span>:x, <span class="hljs-string">&apos;T&apos;</span>:<span class="hljs-number">31</span>, <span class="hljs-string">&apos;T2&apos;</span>:<span class="hljs-number">31</span>*<span class="hljs-number">31</span>})</span><br><span class="line">    x[<span class="hljs-string">&quot;const&quot;</span>]=np.ones(<span class="hljs-number">201</span>)</span><br><span class="line">    y_pred=res.predict(x)</span><br><span class="line">    ax1.plot(x.vaccinated, y_pred*<span class="hljs-number">100</span>_000,<span class="hljs-string">&quot;k--&quot;</span>,label=<span class="hljs-string">&quot;predicted&quot;</span>) </span><br><span class="line">    </span><br><span class="line">    idx = data.index</span><br><span class="line">    ax2.scatter(data[<span class="hljs-string">&quot;vaccinated&quot;</span>], res.resid[idx],</span><br><span class="line">                c=P,norm=norm,cmap=<span class="hljs-string">&quot;Blues&quot;</span>,label=event)</span><br><span class="line">    ax2.set_ybound(lower=<span class="hljs-number">-0.00008</span>,upper=<span class="hljs-number">0.00008</span>)</span><br><span class="line">    ax2.set_title(<span class="hljs-string">&quot;Residuals&quot;</span>)</span><br><span class="line">    ax2.set_xlabel(<span class="hljs-string">&quot;vaccination&quot;</span>)</span><br><span class="line">    ax2.set_ylabel(<span class="hljs-string">&quot;residual&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment"># select outlier state</span></span><br><span class="line">    outlier_idx=np.argpartition(np.array(res.resid[idx]), <span class="hljs-number">-2</span>)[<span class="hljs-number">-2</span>:]</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> outlier_idx:</span><br><span class="line">        outlier=data.iloc[i]</span><br><span class="line">        ax1.annotate(outlier[<span class="hljs-string">&quot;state&quot;</span>],(outlier[<span class="hljs-string">&quot;vaccinated&quot;</span>]+<span class="hljs-number">0.01</span>,outlier[event]/outlier[<span class="hljs-string">&quot;population&quot;</span>]*<span class="hljs-number">100</span>_000))</span><br><span class="line">        ax2.annotate(outlier[<span class="hljs-string">&quot;state&quot;</span>],(outlier[<span class="hljs-string">&quot;vaccinated&quot;</span>]+<span class="hljs-number">0.01</span>,res.resid[idx].iloc[i]))</span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plot_residuals(last_data,event,res)</span><br></pre></td></tr></tbody></table></figure>


<p><img src="Covid_WeightedLinearRegression_files/Covid_WeightedLinearRegression_76_0.png" alt="png"></p>
<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">covid.plot_time_facets(train_data,res,event,date0)</span><br></pre></td></tr></tbody></table></figure>


<p><img src="Covid_WeightedLinearRegression_files/Covid_WeightedLinearRegression_77_0.png" alt="png"></p>
<h2 id="Model-Prediction"><a href="#Model-Prediction" class="headerlink" title="Model Prediction"></a>Model Prediction</h2><p>We will now use the model <strong>without recalibrating</strong> to make predictions about admission rates on new data.</p>
<p>This is <strong>out of sample</strong> evaluation. It is the only way to make sure the model really works.</p>
<p>First, we select a few new dates:</p>
<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test_period=<span class="hljs-number">7</span> <span class="hljs-comment"># days</span></span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test_end=pd.Timestamp(end_train)+pd.DateOffset(days=test_period)</span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">test_data=data[(data[<span class="hljs-string">&quot;date&quot;</span>]&gt;end_train) &amp; (data[<span class="hljs-string">&quot;date&quot;</span>]&lt;=test_end)].copy()</span><br><span class="line">test_data[<span class="hljs-string">&quot;date&quot;</span>].unique()</span><br></pre></td></tr></tbody></table></figure>




<pre><code>array([&apos;2021-08-21T00:00:00.000000000&apos;, &apos;2021-08-16T00:00:00.000000000&apos;,
       &apos;2021-08-17T00:00:00.000000000&apos;, &apos;2021-08-19T00:00:00.000000000&apos;,
       &apos;2021-08-18T00:00:00.000000000&apos;, &apos;2021-08-20T00:00:00.000000000&apos;,
       &apos;2021-08-22T00:00:00.000000000&apos;], dtype=&apos;datetime64[ns]&apos;)</code></pre>
<p>We generate the regression variables for the new data</p>
<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X_test,P_test=covid.define_variables(test_data,date0)</span><br><span class="line">X_test.head()</span><br></pre></td></tr></tbody></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;</code></pre>
<p></style><p></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>vaccinated</th>
      <th>T</th>
      <th>T2</th>
      <th>const</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>4</th>
      <td>0.449196</td>
      <td>37</td>
      <td>1369</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>16</th>
      <td>0.444887</td>
      <td>32</td>
      <td>1024</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>66</th>
      <td>0.444963</td>
      <td>33</td>
      <td>1089</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>79</th>
      <td>0.446743</td>
      <td>35</td>
      <td>1225</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>101</th>
      <td>0.446681</td>
      <td>34</td>
      <td>1156</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Y_test=test_data[event]/test_data[<span class="hljs-string">&quot;population&quot;</span>]</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Out-of-Sample-R-2"><a href="#Out-of-Sample-R-2" class="headerlink" title="Out of Sample $R^2$"></a>Out of Sample $R^2$</h3><p>First we fit the single constant admission rate for the test data to define the <strong>null model</strong> </p>
<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Y_bar=np.sum(Y_test*P_test)/np.sum(P_test)</span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">null_deviance_test=square_error(Y_test,Y_bar,P_test)</span><br><span class="line">null_deviance_test</span><br></pre></td></tr></tbody></table></figure>




<pre><code>1.5894793995786725</code></pre>
<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Y_pred=res.predict(X_test)</span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">deviance_test=square_error(Y_test,Y_pred,P_test)</span><br><span class="line">deviance_test</span><br></pre></td></tr></tbody></table></figure>




<pre><code>1.1348447392311178</code></pre>
<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-number">1</span>-deviance_test/null_deviance_test</span><br></pre></td></tr></tbody></table></figure>




<pre><code>0.2860274002091917</code></pre>
<p>Out of sample $R^2$ is <strong>worse</strong> than for the in sample (\approx 39%). Predicting the future is hard, and all that&#x2026;</p>
<h3 id="Out-of-Sample-Model-Fit"><a href="#Out-of-Sample-Model-Fit" class="headerlink" title="Out of Sample Model Fit"></a>Out of Sample Model Fit</h3><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">covid.plot_time_facets(test_data,res,event,date0)</span><br></pre></td></tr></tbody></table></figure>


<p><img src="Covid_WeightedLinearRegression_files/Covid_WeightedLinearRegression_94_0.png" alt="png"></p>
<p>It seems we are <strong>over estimating</strong> how fast the admission rate is increasing.</p>
<h2 id="Day-of-the-Week-Effects"><a href="#Day-of-the-Week-Effects" class="headerlink" title="Day of the Week Effects"></a>Day of the Week Effects</h2><p>Data reporting has day of the week effects:</p>
<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">aggregate=data.groupby([<span class="hljs-string">&quot;date&quot;</span>])[event].sum()</span><br><span class="line">aggregate=aggregate.to_frame().reset_index()</span><br><span class="line">aggregate.plot(x=<span class="hljs-string">&quot;date&quot;</span>,y=event)</span><br></pre></td></tr></tbody></table></figure>




<pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7feff0dcc850&gt;</code></pre>
<p><img src="Covid_WeightedLinearRegression_files/Covid_WeightedLinearRegression_97_1.png" alt="png"></p>
<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X_train,P_train=covid.define_variables2(train_data,date0)</span><br><span class="line">X_train.head()</span><br></pre></td></tr></tbody></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;</code></pre>
<p></style><p></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>vaccinated</th>
      <th>T</th>
      <th>T2</th>
      <th>const</th>
      <th>Monday</th>
      <th>Saturday</th>
      <th>Sunday</th>
      <th>Thursday</th>
      <th>Tuesday</th>
      <th>Wednesday</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>0.440153</td>
      <td>21</td>
      <td>441</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.431722</td>
      <td>0</td>
      <td>0</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.435852</td>
      <td>10</td>
      <td>100</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.441906</td>
      <td>24</td>
      <td>576</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.437877</td>
      <td>15</td>
      <td>225</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mod=sm.WLS(Y_train,X_train,P_train)</span><br><span class="line">res=mod.fit()</span><br><span class="line">res.summary()</span><br></pre></td></tr></tbody></table></figure>




<table class="simpletable">
<caption>WLS Regression Results</caption>
<tbody><tr>
  <th>Dep. Variable:</th>            <td>y</td>        <th>  R-squared:         </th>  <td>   0.376</td> 
</tr>
<tr>
  <th>Model:</th>                   <td>WLS</td>       <th>  Adj. R-squared:    </th>  <td>   0.372</td> 
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th>  <td>   108.5</td> 
</tr>
<tr>
  <th>Date:</th>             <td>Mon, 20 Sep 2021</td> <th>  Prob (F-statistic):</th>  <td>4.82e-159</td>
</tr>
<tr>
  <th>Time:</th>                 <td>22:36:26</td>     <th>  Log-Likelihood:    </th>  <td>  15155.</td> 
</tr>
<tr>
  <th>No. Observations:</th>      <td>  1632</td>      <th>  AIC:               </th> <td>-3.029e+04</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td>  1622</td>      <th>  BIC:               </th> <td>-3.024e+04</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     9</td>      <th>                     </th>      <td> </td>    
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>      <td> </td>    
</tr>
</tbody></table>
<table class="simpletable">
<tbody><tr>
       <td></td>         <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P&gt;|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>vaccinated</th> <td>   -0.0002</td> <td> 6.13e-06</td> <td>  -24.658</td> <td> 0.000</td> <td>   -0.000</td> <td>   -0.000</td>
</tr>
<tr>
  <th>T</th>          <td> 1.028e-06</td> <td> 1.87e-07</td> <td>    5.484</td> <td> 0.000</td> <td>  6.6e-07</td> <td>  1.4e-06</td>
</tr>
<tr>
  <th>T2</th>         <td>-6.639e-10</td> <td> 5.85e-09</td> <td>   -0.113</td> <td> 0.910</td> <td>-1.21e-08</td> <td> 1.08e-08</td>
</tr>
<tr>
  <th>const</th>      <td> 8.186e-05</td> <td> 3.31e-06</td> <td>   24.752</td> <td> 0.000</td> <td> 7.54e-05</td> <td> 8.83e-05</td>
</tr>
<tr>
  <th>Monday</th>     <td>-2.236e-06</td> <td> 1.66e-06</td> <td>   -1.350</td> <td> 0.177</td> <td>-5.48e-06</td> <td> 1.01e-06</td>
</tr>
<tr>
  <th>Saturday</th>   <td>-8.319e-07</td> <td> 1.55e-06</td> <td>   -0.537</td> <td> 0.591</td> <td>-3.87e-06</td> <td> 2.21e-06</td>
</tr>
<tr>
  <th>Sunday</th>     <td>-3.189e-06</td> <td> 1.55e-06</td> <td>   -2.056</td> <td> 0.040</td> <td>-6.23e-06</td> <td>-1.47e-07</td>
</tr>
<tr>
  <th>Thursday</th>   <td>-2.234e-08</td> <td> 1.55e-06</td> <td>   -0.014</td> <td> 0.988</td> <td>-3.06e-06</td> <td> 3.02e-06</td>
</tr>
<tr>
  <th>Tuesday</th>    <td> 3.233e-07</td> <td> 1.66e-06</td> <td>    0.195</td> <td> 0.845</td> <td>-2.93e-06</td> <td> 3.57e-06</td>
</tr>
<tr>
  <th>Wednesday</th>  <td>-2.672e-07</td> <td> 1.66e-06</td> <td>   -0.161</td> <td> 0.872</td> <td>-3.52e-06</td> <td> 2.98e-06</td>
</tr>
</tbody></table>
<table class="simpletable">
<tbody><tr>
  <th>Omnibus:</th>       <td>1416.223</td> <th>  Durbin-Watson:     </th> <td>   0.364</td> 
</tr>
<tr>
  <th>Prob(Omnibus):</th>  <td> 0.000</td>  <th>  Jarque-Bera (JB):  </th> <td>42872.585</td>
</tr>
<tr>
  <th>Skew:</th>           <td> 4.016</td>  <th>  Prob(JB):          </th> <td>    0.00</td> 
</tr>
<tr>
  <th>Kurtosis:</th>       <td>26.790</td>  <th>  Cond. No.          </th> <td>6.95e+03</td> 
</tr>
</tbody></table><br><br>Notes:<br>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.<br>[2] The condition number is large, 6.95e+03. This might indicate that there are<br>strong multicollinearity or other numerical problems.



<p>Day of the week provides a <strong>small improvement</strong> on $R^2$ compared to original model.</p>
<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></tbody></table></figure>
</body></html>
    
    </div>
    
    
    <div class="columns is-mobile is-multiline article-nav">
        <span class="column is-12-mobile is-half-desktop is-hidden-mobile article-nav-prev">
            
        </span>
        <span class="column is-12-mobile is-half-desktop  article-nav-next">
            
            <a href="/2021/09/20/Project-Covid-Admissions-Based-on-Vaccine-Progress-Part-1/">Project Covid Admissions Based on Vaccine Progress, Part 1</a>
            
        </span>
    </div>
    
</article>




    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2021 Yumeng Li&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        target="_blank" rel="noopener" href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            <div class="column is-narrow">
                <div class="columns is-mobile is-multiline is-centered">
                
                    
                <a class="column is-narrow has-text-black" title="GitHub" target="_blank" rel="noopener" href="https://github.com/ppoffice/hexo-theme-minos">
                    
                    GitHub
                    
                </a>
                
                </div>
            </div>
            
            
        </div>
    </div>
</footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script>

<!-- test if the browser is outdated -->
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" target="_blank" rel="noopener" href="http://outdatedbrowser.com/">Update my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js"></script>
<script>
    $(document).ready(function () {
        // plugin function, place inside DOM ready function
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        })
    });
</script>

<script>
    window.FontAwesomeConfig = {
        searchPseudoElements: true
    }
    moment.locale("en-AU");
</script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script>
    MathJax.Hub.Config({
        "HTML-CSS": {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
</script>

    
    
    
    
<script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/js/jquery.justifiedGallery.min.js"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            if (typeof($.fn.lightGallery) === 'function') {
                $('.article.gallery').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof($.fn.justifiedGallery) === 'function') {
                $('.justified-gallery').justifiedGallery();
            }
        });
    })(jQuery);
</script>

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <style>
        .hljs {
            position: relative;
        }

        .hljs .clipboard-btn {
            float: right;
            color: #9a9a9a;
            background: none;
            border: none;
            cursor: pointer;
        }

        .hljs .clipboard-btn:hover {
          color: #8a8a8a;
        }

        .hljs > .clipboard-btn {
            display: none;
            position: absolute;
            right: 4px;
            top: 4px;
        }

        .hljs:hover > .clipboard-btn {
            display: inline;
        }

        .hljs > figcaption > .clipboard-btn {
            margin-right: 4px;
        }
    </style>
    <script>
      $(document).ready(function () {
        $('figure.hljs').each(function(i, figure) {
          var codeId = 'code-' + i;
          var code = figure.querySelector('.code');
          var copyButton = $('<button>Copy <i class="far fa-clipboard"></i></button>');
          code.id = codeId;
          copyButton.addClass('clipboard-btn');
          copyButton.attr('data-clipboard-target-id', codeId);

          var figcaption = figure.querySelector('figcaption');

          if (figcaption) {
            figcaption.append(copyButton[0]);
          } else {
            figure.prepend(copyButton[0]);
          }
        })

        var clipboard = new ClipboardJS('.clipboard-btn', {
          target: function(trigger) {
            return document.getElementById(trigger.getAttribute('data-clipboard-target-id'));
          }
        });
        clipboard.on('success', function(e) {
          e.clearSelection();
        })
      })
    </script>

    
    

    



<script src="/js/script.js"></script>


    
    <div class="searchbox ins-search">
    <div class="searchbox-mask"></div>
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>

<script src="/js/insight.js"></script>

    
</body>
</html>